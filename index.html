<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kommunalwahl-O-Mat</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h2 {
      margin-top: 30px;
    }
    .candidate-line {
      margin: 6px 0;
      display: flex;
      align-items: center;
    }
    .candidate-line span {
      width: 160px;
      display: inline-block;
    }
    .bar {
      background: #eee;
      border-radius: 6px;
      height: 22px;
      width: 300px;
      overflow: hidden;
      position: relative;
    }
    .fill {
      background: #3b82f6; /* blau, kannst du anpassen */
      height: 100%;
      color: white;
      text-align: right;
      padding-right: 6px;
      font-size: 13px;
      line-height: 22px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>Kommunalwahl-O-Mat</h1>

  <!-- Beispiel-Fragen -->
  <div id="questions">
    <label>Frage 1: Soll die Stadt mehr für Klimaschutz tun?
      <select data-id="1">
        <option value="">--</option>
        <option value="1">Stimme zu</option>
        <option value="0">Neutral</option>
        <option value="-1">Lehne ab</option>
      </select>
    </label>
    <br>
    <label>Frage 2: Soll es mehr Parkplätze in der Innenstadt geben?
      <select data-id="2">
        <option value="">--</option>
        <option value="1">Stimme zu</option>
        <option value="0">Neutral</option>
        <option value="-1">Lehne ab</option>
      </select>
    </label>
  </div>

  <button id="calc">Auswerten</button>
  <div id="results"></div>

  <script>
    // Beispiel-Daten: Antworten von Kandidaten / Parteien
    const answers = {
      "Bürgermeister": {
        "Kandidat A": {1: 1, 2: -1},
        "Kandidat B": {1: -1, 2: 1},
        "Kandidat C": {1: 1, 2: 1}
      },
      "Stadtrat": {
        "Partei X": {1: 1, 2: 0},
        "Partei Y": {1: -1, 2: 1}
      }
    };

    function calcResults() {
      const selects = document.querySelectorAll("#questions select");
      let userAnswers = {};
      selects.forEach(sel=>{
        if(sel.value !== "") userAnswers[sel.dataset.id] = parseInt(sel.value);
      });

      let perBlockEntities = {};
      for (let block in answers) {
        perBlockEntities[block] = {};
        for (let entity in answers[block]) {
          let total = 0, match = 0;
          for (let qid in userAnswers) {
            if (qid in answers[block][entity]) {
              total++;
              if (userAnswers[qid] === answers[block][entity][qid]) {
                match++;
              }
            }
          }
          let pct = total > 0 ? Math.round((match/total)*100) : 0;
          perBlockEntities[block][entity] = pct;
        }
      }
      showResults(perBlockEntities);
    }

    function showResults(perBlockEntities) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      Object.entries(perBlockEntities).forEach(([blockName, entities]) => {
        const sorted = Object.entries(entities).sort((a,b)=>b[1]-a[1]);

        const blockEl = document.createElement("div");
        blockEl.innerHTML = `<h2>${blockName}</h2>`;
        
        sorted.forEach(([name,score])=>{
          const line = document.createElement("div");
          line.className = "candidate-line";
          line.innerHTML = `
            <span>${name}</span>
            <div class="bar">
              <div class="fill" style="width:${score}%">${score}%</div>
            </div>
          `;
          blockEl.appendChild(line);
        });

        resultsDiv.appendChild(blockEl);
      });
    }

    document.getElementById("calc").addEventListener("click", calcResults);
  </script>
</body>
</html>
